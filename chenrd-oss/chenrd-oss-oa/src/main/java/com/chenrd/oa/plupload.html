<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>${title}</title>
<style type="text/css">@import url(plupload-2.1.8/js/jquery.ui.plupload/css/jquery.ui.plupload.css);</style>
<script type="text/javascript" src="plupload-2.1.8/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="plupload-2.1.8/js/jquery-ui.js"></script>
<link rel="stylesheet" href="plupload-2.1.8/jquery-ui.css"/>
<script type="text/javascript" src="http://bp.yahooapis.com/2.4.21/browserplus-min.js"></script>
<script type="text/javascript" src="plupload-2.1.8/js/plupload.full.min.js"></script>
<script type="text/javascript" src="plupload-2.1.8/js/jquery.ui.plupload/jquery.ui.plupload.js"></script>
<script type="text/javascript">
    $(function () {
        $("#uploader").plupload({
            // General settings
            runtimes: 'gears,flash,silverlight,browserplus,html5', // 这里是说用什么技术引擎
            url: '${uploadPath}', // 服务端上传路径
            max_file_size: '10mb', // 文件上传最大限制。
            chunk_size: '1mb', // 上传分块每块的大小，这个值小于服务器最大上传限制的值即可。
            unique_names: true, // 上传的文件名是否唯一
            // Resize images on clientside if we can
            //// 是否生成缩略图（仅对图片文件有效）
            resize: { width: 320, height: 240, quality: 90 },
            // Specify what files to browse for
            ////  这个数组是选择器，就是上传文件时限制的上传文件类型
            filters: [
					{ title: "Image files", extensions: "${suffixs}" }
					],
            // Flash settings
            // plupload.flash.swf 的所在路径
            flash_swf_url: 'plupload-2.1.8/js/plupload.flash.swf',
            // Silverlight settings
            // silverlight所在路径
            silverlight_xap_url: 'plupload-2.1.8/js/plupload.silverlight.xap'
        });
		
        $('#uploader').plupload('getUploader').bind('FileUploaded', function(up, file, res) {
        	var data = eval('('+res.response+')');
        	if (data.message == undefined) {
        		$('#successImport').text(data.successImport);
        		$('#failImport').text(data.failImport);
        		$('#failDetail').text(data.failDetail);
        		$('#replaceNum').text(data.replaceNum);
        		$('#replaceDetail').text(data.replaceDetail);
        		$('#result').show();
        	} else {
        		alert(data.message);
        		$('#result').hide();
        	}
        })
        
        // Client side form validation
        $('form').submit(function (e) {
            var uploader = $('#uploader').plupload('getUploader');
            // Files in queue upload them first
            if (uploader.files.length > 0) {
                // When all files are uploaded submit form
                uploader.bind('StateChanged', function () {
                    if (uploader.files.length === (uploader.total.uploaded + uploader.total.failed)) {
                        $('form')[0].submit();
                    }
                });
                uploader.start();
            } else
                alert('You must at least upload one file.');
            return false;
        });
    });
</script>
</head>
<body marginheight="0" marginwidth="0" style="margin: 0px;padding: 0px;">
    <form id="form1" runat="server" >
     <div id="uploader" style="width: 100%;">
        <p>You browser doesn't have Flash, Silverlight, Gears, BrowserPlus or HTML5 support.</p>
    </div>
    </form>
    <div style="margin: 20px 20px;">
    	<a href="template/${template}" title="${template}" target="_blank">下载模版</a>
    </div>
    <div style="padding: 10px 20px;display: none;" id="result">
    	<span style="color: #333;font-weight: bold;font-size: 18px;display: block;">
    		处理结果：
    	</span>
    	<span style="color: #666;font-size: 14px;display: block;padding-left: 20px;padding-top: 10px;" >
    		成功导入：<span id="successImport"></span>条
    	</span>
    	<span style="color: #666;font-size: 14px;display: block;padding-left: 20px;padding-top: 10px;" >
    		成功替换：<span id="replaceNum"></span>条
    	</span>
    	<span style="color: #666;font-size: 14px;display: block;padding-left: 20px;padding-top: 10px;" >
    		替换详细：<span id="replaceDetail"></span>
    	</span>
    	<span style="color: #666;font-size: 14px;display: block;padding-left: 20px;padding-top: 10px;">
    		失败导入：<span id="failImport"></span>条
    	</span>
    	<span style="color: #666;font-size: 14px;display: block;padding-left: 20px;padding-top: 10px;" >
    		详细：<span id="failDetail"></span>
    	</span>
    </div>
</body>
</html>