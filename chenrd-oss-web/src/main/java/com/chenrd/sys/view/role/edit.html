<style type="text/css">
.vessel{border-bottom: 1px dashed #DCEBFF;}
</style>

<div class="widget">
    <div class="widget-body">
    	<form role="form" method="post">
    		<div id="simplewizardinwidget" class="wizard" data-target="#simplewizardinwidget-steps">
                <ul class="steps">
                    <li data-target="#simplewizardinwidgetstep1" class="active"><span class="step">1</span>基本信息<span class="chevron"></span></li>
                    <li data-target="#simplewizardinwidgetstep2"><span class="step">2</span>菜单权限<span class="chevron"></span></li>
                    <li data-target="#simplewizardinwidgetstep3"><span class="step">3</span>功能权限<span class="chevron"></span></li>
                </ul>
                <div class="actions" id="simplewizardinwidget-actions">
                    <button type="button" class="btn btn-default btn-sm shiny btn-prev"> <i class="fa fa-angle-left"></i>上一步</button>
                    <button type="button" class="btn btn-default btn-sm shiny btn-next" data-last="Finish">下一步<i class="fa fa-angle-right"></i></button>
                </div>
            </div>
            <div class="step-content" id="simplewizardinwidget-steps">
	                <div class="step-pane active" id="simplewizardinwidgetstep1">
	                	<div class="form-group">
	                		<input type="text" class="form-control" id="username" name="name" value="<#if bean??>${bean.name}</#if>" placeholder="名称"
	                        data-bv-message="用户名无效"
                                         data-bv-notempty="true"
                                         data-bv-notempty-message="用户名不能为空"
                                         />
	                	</div>
	                	<div class="form-group">
	                		<input type="text" class="form-control" id="username" name="key" value="<#if bean??>${bean.key}</#if>" placeholder="标识：（100/200）"
	                        data-bv-message="用户名无效"
                                         data-bv-notempty="true"
                                         data-bv-notempty-message="用户名不能为空"
                                         />
	                	</div>
	                	<div class="form-group">
	                		<textarea class="form-control" rows="6" id="form-field-8" name="remark" placeholder="Default Text"><#if bean??>${bean.remark}</#if></textarea>
	                	</div>
	                </div>
	                <div class="step-pane" id="simplewizardinwidgetstep2">
	                	<div class="form-title"></div>
	                	<div class="form-group" style="height: 300px;">
					    	<div style="width: 42%;border: 1px solid rgba(0,0,0,.25);background: white;box-shadow: 0 1px 3px rgba(0,0,0,.3);float: left;">
						    	<ul class="select2-results" result-target="power_result" data-target="vessel2" id="vessel1" style="min-height: 300px;max-height: 300px;">
						    		<#list menus as menu>
							    		<li class="select2-results-dept-0 select2-result select2-result-selectable" value="${menu.id}" index="${menu_index}">
							    			<div class="select2-result-label">
							    			<span class="select2-match"></span>${menu.fullName}
		                                	</div>
		                            	</li>
	                            	</#list>
	                            </ul>
					    	</div>
					    	<div style="width: 42%;border: 1px solid rgba(0,0,0,.25);background: white;box-shadow: 0 1px 3px rgba(0,0,0,.3);float: right;height: 300px;">
					    		<ul class="select2-results vessel" data-target="vessel1" id="vessel2" style="min-height: 300px;max-height: 300px;">
					    			
					    		</ul>
					    	</div>
					    	<div style="width: 80px;margin: 0px auto;height: 300px;vertical-align: middle;padding-top: 120px;">
					    		<a class="btn btn-default purple checkall" href="javascript:void(0);" style="width: 100%"><i class="fa fa-angle-double-right"></i> 全选</a>
					    		<a class="btn btn-default purple notcheckall" href="javascript:void(0);" style="width: 100%"><i class="fa fa-angle-double-left"></i> 全不选</a>
					    	</div>
					    </div>
                	</div>
                	<div class="step-pane" id="simplewizardinwidgetstep3">
	                	<div class="form-title"></div>
	                	<div class="form-group" style="height: 300px;">
					    	<div style="width: 42%;border: 1px solid rgba(0,0,0,.25);background: white;box-shadow: 0 1px 3px rgba(0,0,0,.3);float: left;">
						    	<ul class="select2-results" result-target="power_result" data-target="vessel4" id="vessel3" style="min-height: 300px;max-height: 300px;">
						    		<#list funcs as menu>
							    		<li class="select2-results-dept-0 select2-result select2-result-selectable" value="${menu.id}" index="${menu_index}">
							    			<div class="select2-result-label">
							    			<span class="select2-match"></span>${menu.fullName}
		                                	</div>
		                            	</li>
	                            	</#list>
	                            </ul>
					    	</div>
					    	<div style="width: 42%;border: 1px solid rgba(0,0,0,.25);background: white;box-shadow: 0 1px 3px rgba(0,0,0,.3);float: right;height: 300px;">
					    		<ul class="select2-results vessel" data-target="vessel3" id="vessel4" style="min-height: 300px;max-height: 300px;">
					    			
					    		</ul>
					    	</div>
					    	<div style="width: 80px;margin: 0px auto;height: 300px;vertical-align: middle;padding-top: 120px;">
					    		<a class="btn btn-default purple checkall" href="javascript:void(0);" style="width: 100%"><i class="fa fa-angle-double-right"></i> 全选</a>
					    		<a class="btn btn-default purple notcheckall" href="javascript:void(0);" style="width: 100%"><i class="fa fa-angle-double-left"></i> 全不选</a>
					    	</div>
					    </div>
                	</div>
                	<span id="power_result"></span>
                	<input type="hidden" value="<#if bean??>${bean.id}</#if>" name="id" id="id"/>
	            </form>
            </div>
    </div>
</div>
<script type="text/javascript" src="assets/js/fuelux/wizard/wizard-custom.js"></script>
<script type="text/javascript" src="assets/js/toastr/toastr.js"></script>
<script type="text/javascript">
	$(function() {
		var myPannel = tab.current;
		$('#simplewizardinwidget').wizard().on('finished', function (e) {
			Home.startLoadingContainer();
			$.ajax({
				url: "<@url value='role/saveOrUpdate'/>",
				type: 'post',
				data: myPannel.center.find('form input,form textarea').serialize(),
				success: function(data) {
					Home.stopLoadingContainer();
					Home.callback(data);
				}
			}) 
		});
		
		$('.select2-results li').mousemove(function() {
			$(this).addClass('select2-highlighted');
		}).mouseout(function(){
			$(this).removeClass('select2-highlighted');
		}).click(function(){
			var _this = $(this), _to = $('#' + $(this).parent().attr('data-target'));
			var resultId = _this.parent().attr('result-target')
			var isT = false;
			for (var i = 0; i < _to.find('li').length; i++) {
				var n = _to.find('li')[i];
				if (parseInt(_this.attr('index')) < parseInt($(n).attr('index'))) {
					$(n).before(_this);
					isT = true;
					break;
				}
			}
			if (!isT) {
				_to.append(_this);
			}
			
			if (resultId != undefined) {
				$('#' + resultId).append('<input type="hidden" name="powers" value="' + _this.val() + '"/>');
			} else {
				$('input[value="' + _this.val() + '"]').remove();
			}
		})
		
		
		
		myPannel.center.find('.checkall').click(function() {
			var i = parseInt($('#simplewizardinwidget .steps .active span').text()) - 1;
			i = i * 2 - 1;
			$('#vessel' + i + ' li').each(function(i, n) {
				$(n).click();
			})
		})
		
		myPannel.center.find('.notcheckall').click(function() {
			var i = parseInt($('#simplewizardinwidget .steps .active span').text()) - 1;
			i = i * 2;
			$('#vessel' + i + ' li').each(function(i, n) {
				$(n).click();
			})
		})
		
		var powers = '<#if bean??>${bean.powers}</#if>';
		$.each(powers.split(','), function(i, n) {
			$('.select2-results li[value="' + n + '"]').click();
		})
	})
</script>
</body>
</html>

